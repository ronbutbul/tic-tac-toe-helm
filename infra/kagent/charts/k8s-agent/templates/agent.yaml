apiVersion: kagent.dev/v1alpha2
kind: Agent
metadata:
  name: k8s-agent
  namespace: {{ include "kagent.namespace" . }}
  labels:
    {{- include "kagent.labels" . | nindent 4 }}
spec:
  description: An Kubernetes Expert AI Agent specializing in cluster operations, troubleshooting, and maintenance.
  type: Declarative
  declarative:
    systemMessage: |
      # Kubernetes AI Agent System Prompt

      You are KubeAssist, an advanced AI agent specialized in Kubernetes troubleshooting and operations. You have deep expertise in Kubernetes architecture, container orchestration, networking, storage systems, and resource management. Your purpose is to help users diagnose and resolve Kubernetes-related issues while following best practices and security protocols.

      Always start with the least intrusive approach, and escalate diagnostics only as needed. When in doubt, gather more information before recommending changes.
    modelConfig: {{ .Values.modelConfigRef | default (printf "%s" (include "kagent.defaultModelConfigName" .)) }}
    tools:
    - type: McpServer
      mcpServer:
        name: kagent-tool-server
        kind: RemoteMCPServer
        apiGroup: kagent.dev
        toolNames:
        - k8s_check_service_connectivity
        - k8s_patch_resource
        - k8s_remove_annotation
        - k8s_annotate_resource
        - k8s_remove_label
        - k8s_label_resource
        - k8s_create_resource
        - k8s_create_resource_from_url
        - k8s_get_events
        - k8s_get_available_api_resources
        - k8s_get_cluster_configuration
        - k8s_describe_resource
        - k8s_delete_resource
        - k8s_get_resource_yaml
        - k8s_execute_command
        - k8s_apply_manifest
        - k8s_get_resources
        - k8s_get_pod_logs
    a2aConfig:
      skills:
        - id: cluster-diagnostics
          name: Cluster Diagnostics
          description: The ability to analyze and diagnose Kubernetes Cluster issues.
          tags:
            - cluster
            - diagnostics
          examples:
            - "What is the status of my cluster?"
            - "How can I troubleshoot a failing pod?"
            - "What are the resource limits for my nodes?"
        - id: resource-management
          name: Resource Management
          description: The ability to manage and optimize Kubernetes resources.
          tags:
            - resource
            - management
          examples:
            - "Scale my deployment X to 3 replicas."
            - "Optimize resource requests for my pods."
            - "Reserve more CPU for my nodes."
        - id: security-audit
          name: Security Audit
          description: The ability to audit and enhance Kubernetes security.
          tags:
            - security
            - audit
          examples:
            - "Check for RBAC misconfigurations."
            - "Audit my network policies."
            - "Identify potential security vulnerabilities in my cluster."
    deployment:
      resources:
        {{- toYaml .Values.resources | nindent 8 }}
